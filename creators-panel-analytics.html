<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics de Mercado - Panel de Creadores | PLAYTEST</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="navigation-service.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0D1B2A;
            min-height: 100vh;
            color: #E0E1DD;
        }

        /* User header styles */
        .user-header {
            background: #415A77;
            color: #E0E1DD;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3B82F6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-details h4 {
            margin: 0;
            font-size: 14px;
            color: #E0E1DD;
        }

        .user-details p {
            margin: 0;
            font-size: 12px;
            color: #778DA9;
        }

        .logout-btn {
            background: #EF4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #DC2626;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .tabs-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 0;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 160px;
        }

        .tab-button.active {
            color: #667eea;
            background: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.1);
        }

        .tab-button:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .tab-content {
            padding: 30px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .metric-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-card .label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .metric-card .change {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .change.positive {
            color: #28a745;
        }

        .change.negative {
            color: #dc3545;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }

        .chart-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .chart-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .competitors-table {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        td {
            font-size: 0.9rem;
            color: #666;
        }

        .rank-badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .opportunities-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            margin-top: 20px;
        }

        .opportunity-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .opportunity-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .opportunity-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .opportunity-metrics {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .opportunity-metric {
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 8px 16px;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .period-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            background: #f8d7da;
            border-radius: 10px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .tab-button {
                min-width: 120px;
                padding: 12px 15px;
                font-size: 12px;
            }

            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .opportunity-metrics {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- User Header -->
    <div class="user-header">
        <div class="user-info">
            <div class="user-avatar" id="user-avatar">C</div>
            <div class="user-details">
                <h4 id="user-name">Cargando...</h4>
                <p id="user-role">Creador de Contenido</p>
            </div>
        </div>
        <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
    </div>
    <div class="container">
        <div class="header">
            <h1>üìä Panel de Creadores - Analytics de Mercado</h1>
            <p>Analiza tu posicionamiento competitivo y descubre oportunidades de crecimiento</p>
        </div>

        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-button active" onclick="showTab('analytics')">üìä Analytics de Mercado</button>
                <button class="tab-button" onclick="window.location.href='creators-panel-marketing.html'">üì¢ Marketing</button>
                <button class="tab-button" onclick="window.location.href='creators-panel-tournaments.html'">üèÜ Torneos</button>
                <button class="tab-button" onclick="window.location.href='creators-panel-monetization.html'">üí∞ Monetizaci√≥n</button>
                <button class="tab-button" onclick="window.location.href='creators-panel-content.html'">üìù Contenido</button>
            </div>

            <div class="tab-content active" id="analytics-tab">
                <!-- Period Selector -->
                <div class="period-selector">
                    <button class="period-btn active" onclick="changePeriod('7')">7 d√≠as</button>
                    <button class="period-btn" onclick="changePeriod('30')">30 d√≠as</button>
                    <button class="period-btn" onclick="changePeriod('90')">90 d√≠as</button>
                    <button class="period-btn" onclick="changePeriod('365')">1 a√±o</button>
                </div>

                <!-- M√©tricas Principales -->
                <div class="metrics-grid" id="main-metrics">
                    <div class="loading">Cargando m√©tricas...</div>
                </div>

                <!-- Gr√°ficos de Tendencias -->
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">Tendencias de Ranking</div>
                            <div class="chart-subtitle">Evoluci√≥n de tu posici√≥n en el mercado</div>
                        </div>
                        <canvas id="rankingChart" width="400" height="200"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">Revenue y ROI</div>
                            <div class="chart-subtitle">Rendimiento financiero en el tiempo</div>
                        </div>
                        <canvas id="revenueChart" width="400" height="200"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">Engagement y Retenci√≥n</div>
                            <div class="chart-subtitle">M√©tricas de audiencia activa</div>
                        </div>
                        <canvas id="engagementChart" width="400" height="200"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">An√°lisis de Audiencia</div>
                            <div class="chart-subtitle">Patrones de actividad por hora</div>
                        </div>
                        <canvas id="audienceChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- An√°lisis de Competidores -->
                <div class="competitors-table">
                    <h3>üèÖ An√°lisis de Competidores</h3>
                    <p class="chart-subtitle">Top 10 competidores en tu categor√≠a</p>
                    
                    <div class="table-responsive">
                        <table id="competitors-table">
                            <thead>
                                <tr>
                                    <th>Ranking</th>
                                    <th>Competidor</th>
                                    <th>Bloques</th>
                                    <th>Rating</th>
                                    <th>Est. Revenue</th>
                                    <th>Usuarios</th>
                                    <th>Estrategia</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" class="loading">Cargando datos de competidores...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Oportunidades de Mercado -->
                <div class="opportunities-section">
                    <h3>üí° Oportunidades de Mercado</h3>
                    <p class="chart-subtitle">Oportunidades identificadas autom√°ticamente para tu crecimiento</p>
                    
                    <div id="opportunities-container">
                        <div class="loading">Analizando oportunidades de mercado...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentPeriod = '30';
        let charts = {};
        let marketData = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', async () => {
            await loadMarketAnalytics();
        });

        // Cambiar per√≠odo de an√°lisis
        async function changePeriod(period) {
            currentPeriod = period;
            
            // Actualizar botones
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Recargar datos
            await loadMarketAnalytics();
        }

        // Cargar analytics de mercado
        async function loadMarketAnalytics() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    showError('No autenticado');
                    return;
                }

                // Cargar dashboard principal
                const dashboardResponse = await fetch('/api/creators-panel/market-analytics/dashboard', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!dashboardResponse.ok) {
                    throw new Error('Error cargando dashboard');
                }

                const dashboardData = await dashboardResponse.json();
                
                // Cargar tendencias
                const trendsResponse = await fetch(`/api/creators-panel/market-analytics/trends?period=${currentPeriod}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const trendsData = trendsResponse.ok ? await trendsResponse.json() : { trends: [] };

                // Cargar an√°lisis de audiencia
                const audienceResponse = await fetch('/api/creators-panel/market-analytics/audience', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const audienceData = audienceResponse.ok ? await audienceResponse.json() : { audience: {}, activityPatterns: [] };

                marketData = {
                    dashboard: dashboardData,
                    trends: trendsData,
                    audience: audienceData
                };

                renderMainMetrics(dashboardData.metrics);
                renderCompetitorsTable(dashboardData.competitors);
                renderOpportunities(dashboardData.opportunities);
                renderCharts(trendsData.trends, audienceData);

            } catch (error) {
                console.error('Error cargando analytics:', error);
                showError('Error cargando datos de analytics');
            }
        }

        // Renderizar m√©tricas principales
        function renderMainMetrics(metrics) {
            const container = document.getElementById('main-metrics');
            
            if (!metrics) {
                container.innerHTML = '<div class="error">No hay datos de m√©tricas disponibles</div>';
                return;
            }

            container.innerHTML = `
                <div class="metric-card">
                    <span class="icon">üèÜ</span>
                    <div class="value">#${metrics.market_rank || 'N/A'}</div>
                    <div class="label">Ranking de Mercado</div>
                    <div class="change positive">‚Üó Categor√≠a #${metrics.category_rank || 'N/A'}</div>
                </div>

                <div class="metric-card">
                    <span class="icon">üí∞</span>
                    <div class="value">$${(metrics.revenue_current_month || 0).toLocaleString()}</div>
                    <div class="label">Revenue Mes Actual</div>
                    <div class="change ${metrics.revenue_current_month > metrics.revenue_last_month ? 'positive' : 'negative'}">
                        ${metrics.revenue_current_month > metrics.revenue_last_month ? '‚Üó' : '‚Üò'} 
                        ${Math.abs(((metrics.revenue_current_month - metrics.revenue_last_month) / Math.max(metrics.revenue_last_month, 1) * 100) || 0).toFixed(1)}%
                    </div>
                </div>

                <div class="metric-card">
                    <span class="icon">üìà</span>
                    <div class="value">${(metrics.roi_percentage || 0).toFixed(1)}%</div>
                    <div class="label">ROI Promedio</div>
                    <div class="change positive">CPA: $${(metrics.cpa_cost || 0).toFixed(2)}</div>
                </div>

                <div class="metric-card">
                    <span class="icon">üë•</span>
                    <div class="value">${(metrics.active_users_count || 0).toLocaleString()}</div>
                    <div class="label">Usuarios Activos</div>
                    <div class="change positive">‚Üó ${(metrics.retention_rate || 0).toFixed(1)}% retenci√≥n</div>
                </div>

                <div class="metric-card">
                    <span class="icon">‚≠ê</span>
                    <div class="value">${(metrics.engagement_score || 0).toFixed(1)}</div>
                    <div class="label">Score de Engagement</div>
                    <div class="change positive">‚òÖ ${(metrics.satisfaction_rating || 0).toFixed(1)} satisfacci√≥n</div>
                </div>

                <div class="metric-card">
                    <span class="icon">üìö</span>
                    <div class="value">${metrics.total_blocks || 0}</div>
                    <div class="label">Bloques P√∫blicos</div>
                    <div class="change positive">‚ñ∂ ${(metrics.total_plays || 0).toLocaleString()} plays</div>
                </div>
            `;
        }

        // Renderizar tabla de competidores
        function renderCompetitorsTable(competitors) {
            const tbody = document.querySelector('#competitors-table tbody');
            
            if (!competitors || competitors.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="error">No hay datos de competidores disponibles</td></tr>';
                return;
            }

            tbody.innerHTML = competitors.map(competitor => `
                <tr>
                    <td><span class="rank-badge">#${competitor.competitor_rank}</span></td>
                    <td><strong>${competitor.competitor_name}</strong></td>
                    <td>${competitor.blocks_count || 0}</td>
                    <td>‚≠ê ${(competitor.avg_rating || 0).toFixed(1)}</td>
                    <td>$${(competitor.estimated_revenue || 0).toLocaleString()}</td>
                    <td>${(competitor.user_count || 0).toLocaleString()}</td>
                    <td><span style="font-size: 0.8rem; background: #f0f0f0; padding: 2px 6px; border-radius: 4px;">${competitor.pricing_strategy || 'N/A'}</span></td>
                </tr>
            `).join('');
        }

        // Renderizar oportunidades
        function renderOpportunities(opportunities) {
            const container = document.getElementById('opportunities-container');
            
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="error">No se encontraron oportunidades en este momento</div>';
                return;
            }

            container.innerHTML = opportunities.map(opportunity => `
                <div class="opportunity-card">
                    <div class="opportunity-title">${opportunity.title}</div>
                    <div class="opportunity-description">${opportunity.description}</div>
                    <div class="opportunity-metrics">
                        <div class="opportunity-metric">
                            <strong>üí∞ ${(opportunity.estimated_revenue_potential || 0).toLocaleString()}</strong> potential
                        </div>
                        <div class="opportunity-metric">
                            <strong>üéØ ${Math.round((opportunity.confidence_score || 0) * 100)}%</strong> confianza
                        </div>
                        <div class="opportunity-metric">
                            <strong>‚ö° ${opportunity.urgency_level || 'medium'}</strong> urgencia
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Renderizar gr√°ficos
        function renderCharts(trends, audienceData) {
            // Limpiar gr√°ficos existentes
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};

            if (!trends || trends.length === 0) {
                console.warn('No hay datos de tendencias para mostrar');
                return;
            }

            const ctx1 = document.getElementById('rankingChart');
            const ctx2 = document.getElementById('revenueChart');
            const ctx3 = document.getElementById('engagementChart');
            const ctx4 = document.getElementById('audienceChart');

            // Gr√°fico de Ranking
            if (ctx1) {
                charts.ranking = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: trends.map(t => new Date(t.date_recorded).toLocaleDateString()),
                        datasets: [{
                            label: 'Ranking de Mercado',
                            data: trends.map(t => t.market_rank),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                reverse: true,
                                beginAtZero: false
                            }
                        }
                    }
                });
            }

            // Gr√°fico de Revenue
            if (ctx2) {
                charts.revenue = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: trends.map(t => new Date(t.date_recorded).toLocaleDateString()),
                        datasets: [{
                            label: 'Revenue',
                            data: trends.map(t => t.revenue_current_month || 0),
                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                            borderColor: '#28a745',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Gr√°fico de Engagement
            if (ctx3) {
                charts.engagement = new Chart(ctx3, {
                    type: 'line',
                    data: {
                        labels: trends.map(t => new Date(t.date_recorded).toLocaleDateString()),
                        datasets: [{
                            label: 'Usuarios Activos',
                            data: trends.map(t => t.active_users_count || 0),
                            borderColor: '#fd7e14',
                            backgroundColor: 'rgba(253, 126, 20, 0.1)',
                            yAxisID: 'y'
                        }, {
                            label: 'Retenci√≥n (%)',
                            data: trends.map(t => t.retention_rate || 0),
                            borderColor: '#6f42c1',
                            backgroundColor: 'rgba(111, 66, 193, 0.1)',
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                },
                            }
                        }
                    }
                });
            }

            // Gr√°fico de Audiencia
            if (ctx4 && audienceData.activityPatterns) {
                charts.audience = new Chart(ctx4, {
                    type: 'radar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => i + ':00'),
                        datasets: [{
                            label: 'Sesiones por Hora',
                            data: Array.from({length: 24}, (_, hour) => {
                                const pattern = audienceData.activityPatterns.find(p => p.hour_of_day == hour);
                                return pattern ? pattern.session_count : 0;
                            }),
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.2)',
                            pointBackgroundColor: '#17a2b8'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // Mostrar error
        function showError(message) {
            const container = document.getElementById('main-metrics');
            container.innerHTML = `<div class="error">${message}</div>`;
        }

        // Funci√≥n para mostrar tabs (usado por navegaci√≥n)
        function showTab(tabName) {
            // Esta funci√≥n mantiene compatibilidad con la navegaci√≥n entre pesta√±as
            console.log('Switching to tab:', tabName);
        }
    </script>
    <script>
        let currentUser = null;

        // Load user data on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadUserData();
        });

        async function loadUserData() {
            try {
                const token = localStorage.getItem('playtest_auth_token') || localStorage.getItem('authToken');
                if (!token) {
                    logout();
                    return;
                }

                // Try to get user info from token
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    
                    const userData = JSON.parse(jsonPayload);
                    currentUser = userData;
                    
                    document.getElementById('user-name').textContent = userData.email || userData.username || 'Creador';
                    document.getElementById('user-avatar').textContent = (userData.email || userData.username || 'C')[0].toUpperCase();
                    
                } catch (tokenError) {
                    document.getElementById('user-name').textContent = 'Creador de Contenido';
                    document.getElementById('user-avatar').textContent = 'C';
                }
                
            } catch (error) {
                console.error('Error loading user data:', error);
                document.getElementById('user-name').textContent = 'Creador de Contenido';
                document.getElementById('user-avatar').textContent = 'C';
            }
        }

        function logout() {
            localStorage.removeItem('playtest_auth_token');
            localStorage.removeItem('authToken');
            localStorage.removeItem('user_data');
            localStorage.removeItem('user_role');
            
            try {
                alert('Sesi√≥n cerrada correctamente');
            } catch(e) {}
            
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>